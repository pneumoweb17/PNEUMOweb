<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNEUMOweb - Pneumonia Screening</title>
    <link rel="stylesheet" href="screening.css">
</head>
<div id="split-transition" class="split-transition-overlay">
    <div class="split-left"></div>
    <div class="split-right"></div>
</div>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <nav class="navigation">
                <a href="index.html" class="nav-link">Home</a>
                <a href="pages.html?page=background" class="nav-link">Background</a>
                <a href="pages.html?page=faq" class="nav-link">FAQ</a>
                <a href="pages.html?page=feedback" class="nav-link">FEEDBACK</a>
            </nav>
            <div class="language-toggle">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="fil">Filipino</option>
                </select>
            </div>
        </header>

        <!-- Title Section -->
        <section class="title-section">
            <div class="logo-container">
                <div class="logo-placeholder">
                    <img src="logo.png" alt="PNEUMOweb Logo" class="logo-img">   
                </div>
            </div>
            <div class="title-content">
                <h1 class="main-title">PNEUMOweb</h1>
                <p class="subtitle">Web-based pneumonia screening system</p>
            </div>
        </section>

        <!-- Body Section -->
        <section class="body-section">
            <!-- Screening Questions View -->
            <div id="screening-view" class="screening-container">
                <button class="exit-btn" onclick="exitScreening()">Exit</button>

                <div class="category-header">
                    <h2 id="category-title">Basic Information</h2>
                </div>

                <div class="question-container">
                    <div class="question-navigation">
                        <button id="prev-btn" class="nav-btn" onclick="previousQuestion()" disabled>
                            <span>&lt;</span>
                        </button>

                        <div class="question-content">
                            <div class="question-number">
                                <span>Question Number: </span><span id="current-question">1</span>/<span id="total-questions">21</span>
                            </div>
                            <div class="question-text" id="question-text">
                                1. How old are you?
                            </div>
                            <div class="answer-options" id="answer-options">
                                <input type="number" id="age-input" class="number-input" placeholder="0" min="0" max="120">
                            </div>
                        </div>

                        <button id="next-btn" class="nav-btn" onclick="nextQuestion()">
                            <span>&gt;</span>
                        </button>
                    </div>
                </div>

                <div class="submit-container" id="submit-container" style="display: none;">
                    <button id="submit-btn" class="submit-btn" onclick="submitAnswers()">Submit</button>
                </div>

            </div>

            <!-- Summary View -->
            <div id="summary-view" class="summary-container" style="display: none;">
                <button class="exit-btn" onclick="exitScreening()">Exit</button>

                <div class="category-header">
                    <h2>Answer Summary </h2>
                </div>

                <div class="summary-content">
                    <div class="summary-questions" id="summary-questions">
                        <!-- Summary will be populated here -->
                    </div>

                    <div class="summary-actions">
                        <button class="confirm-btn" onclick="proceedToResult()">Confirm</button>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer Section -->
        <footer class="footer">
            <div class="disclaimer-box">
                <strong>Disclaimer:</strong>
                    This screening tool is for informational purposes only and does not replace professional medical advice.
            </div>
            <div class="footer-background-placeholder">
                <!-- Footer background image will be placed here -->
            </div>
        </footer>
    </div>

    <!-- Exit Confirmation Modal -->
    <div id="exit-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <p>Are you sure you want to leave?</p>
            <div class="modal-buttons">
                <button onclick="confirmExit()" class="modal-btn confirm">Yes</button>
                <button onclick="cancelExit()" class="modal-btn cancel">No</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestionIndex = 0;
        let answers = {};
        let isInSummaryMode = false;

        const questions = [
            { category: "Basic Information", question: "1. How old are you?", type: "number", key: "age" },
            { category: "Basic Information", question: "2. What is your sex/gender?", type: "choice", options: ["Male", "Female"], key: "gender" },
            { category: "Basic Information", question: "3. How many days have you been feeling unwell?", type: "number", key: "unwell_days" },
            { category: "Primary Symptoms", question: "4. Do you have a cough?", type: "yesno", key: "cough" },
            { category: "Primary Symptoms", question: "5. How long have you had this cough?", type: "choice", options: ["Less than 3 days", "3-7 days", "More than a week"], key: "cough_duration" },
            { category: "Primary Symptoms", question: "6. Are you coughing up phlegm or thick mucus?", type: "yesno", key: "phlegm" },
            { category: "Primary Symptoms", question: "7. Do you have a fever?", type: "yesno", key: "fever" },
            { category: "Primary Symptoms", question: "8. Have you experienced chills or sweating?", type: "yesno", key: "chills" },
            { category: "Breathing Symptoms", question: "9. Are you having difficulty breathing or short of breath?", type: "yesno", key: "breathing_difficulty" },
            { category: "Breathing Symptoms", question: "10. Do you have chest pain when breathing deeply or coughing?", type: "yesno", key: "chest_pain" },
            { category: "Breathing Symptoms", question: "11. Is your breathing faster than usual?", type: "yesno", key: "fast_breathing" },
            { category: "General Condition", question: "12. Do you feel weak or extremely tired?", type: "yesno", key: "weakness" },
            { category: "General Condition", question: "13. Have you lost your appetite in the past few days?", type: "yesno", key: "appetite_loss" },
            { category: "General Condition", question: "14. Have you experienced nausea or dizziness?", type: "yesno", key: "nausea" },
            { category: "For Children (If Applicable)", question: "15. Is the child feeding poorly or refusing food/milk?", type: "yesno", key: "child_feeding" },
            { category: "For Children (If Applicable)", question: "16.  Is the child breathing rapidly or does the chest pull inward when breathing?", type: "yesno", key: "child_breathing" },
            { category: "Risk Factors", question: "17. Have you recently been sick with flu, colds, or any respiratory illness?", type: "yesno", key: "recent_illness" },
            { category: "Risk Factors", question: "18. Do you smoke or live with someone who smokes?", type: "yesno", key: "smoking" },
            { category: "Risk Factors", question: "19. Have you been vaccinated against pneumonia (such as PCV or flu vaccine)?", type: "yesno", key: "vaccination" },
            { category: "Risk Factors", question: "20. Do you have any chronic illnesses (asthma, heart disease, diabetes, weak immune system, or malnutrition)?", type: "yesno", key: "chronic-illness" },
            { category: "Risk Factors", question: `21. Is your breathing fast based on your age? (Count breaths per minute)
            <ul style="margin-top:0.5em;">
            <li>2–11 months: ≥50/min</li>
            <li>12–59 months: ≥40/min</li>
            <li>≥5 years/adults: ≥30/min (approx.)</li>
            </ul>`, type: "yesno", key: "fast-breathing-age" },
        ];

        function displayQuestion() {
            const question = questions[currentQuestionIndex];

            document.getElementById('category-title').textContent = question.category;
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('question-text').innerHTML = question.question;

            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';

            if (question.type === 'yesno') {
                const yesLabel = translations[currentLanguage].questions[currentQuestionIndex].options[0] || 'Yes';
                const noLabel = translations[currentLanguage].questions[currentQuestionIndex].options[1] || 'No';
                const yesBtn = createButton(yesLabel, () => selectAnswer(yesLabel));
                const noBtn = createButton(noLabel, () => selectAnswer(noLabel));
                optionsContainer.appendChild(yesBtn);
                optionsContainer.appendChild(noBtn);
            } else if (question.type === 'choice') {
                question.options.forEach(option => {
                    const btn = createButton(option, () => selectAnswer(option));
                    optionsContainer.appendChild(btn);
                });
            } else if (question.type === 'number') {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'number-input';
                input.placeholder = '0';
                input.min = '0';
                if (question.key === 'age') input.max = '120';
                input.addEventListener('input', (e) => selectAnswer(e.target.value));
                optionsContainer.appendChild(input);
            }

            // Skip cough duration if no cough
            if (question.key === "cough_duration" && (answers.cough === "No" || answers.cough === "Hindi")) {
                answers.cough_duration = "Skipped";
                optionsContainer.innerHTML = '<span style="color:gray;">Skipped</span>';
                updateNavigationButtons();
                updateSubmitButton();
                return;
            }

            // Skip child-specific questions if age >= 18
            if ((question.key === "child_feeding" || question.key === "child_breathing") && answers.age >= 18) {
                answers[question.key] = "Skipped";
                optionsContainer.innerHTML = '<span style="color:gray;">Skipped</span>';
                updateNavigationButtons();
                updateSubmitButton();
                return;
            }

            highlightCurrentAnswer();
            updateNavigationButtons();
            updateSubmitButton();
        }

        function createButton(text, onClick) {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = text;
            btn.onclick = onClick;
            return btn;
        }

        function selectAnswer(value) {
            const question = questions[currentQuestionIndex];
            answers[question.key] = value;
            highlightCurrentAnswer();
            updateNavigationButtons();
            updateSubmitButton();
        }

        function highlightCurrentAnswer() {
            const question = questions[currentQuestionIndex];
            let currentAnswer = answers[question.key];

            if (question.type === 'yesno' || question.type === 'choice') {
                const enOptions = translations.en.questions[currentQuestionIndex].options || [];
                const filOptions = translations.fil.questions[currentQuestionIndex].options || [];
                if (currentLanguage === 'fil') {
                    const idx = enOptions.indexOf(currentAnswer);
                    if (idx !== -1) currentAnswer = filOptions[idx];
                    if (currentAnswer === "Yes") currentAnswer = "Oo";
                    if (currentAnswer === "No") currentAnswer = "Hindi";
                } else {
                    const idx = filOptions.indexOf(currentAnswer);
                    if (idx !== -1) currentAnswer = enOptions[idx];
                    if (currentAnswer === "Oo") currentAnswer = "Yes";
                    if (currentAnswer === "Hindi") currentAnswer = "No";
                }
            }

            if (question.type === 'number') {
                const input = document.querySelector('.number-input');
                if (input && currentAnswer) {
                    input.value = currentAnswer;
                    input.style.backgroundColor = '#27ae60';
                    input.style.color = 'white';
                }
            } else {
                const buttons = document.querySelectorAll('.option-btn');
                buttons.forEach(btn => {
                    if (btn.textContent === currentAnswer) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            prevBtn.disabled = currentQuestionIndex === 0;

            const question = questions[currentQuestionIndex];
            const hasAnswer = answers[question.key] !== undefined && answers[question.key] !== '';

            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'block';
                nextBtn.disabled = !hasAnswer;
                if (hasAnswer) {
                    nextBtn.style.backgroundColor = '#04a922';
                    nextBtn.style.color = '#fff';
                } else {
                    nextBtn.style.backgroundColor = '';
                    nextBtn.style.color = '';
                }
            }
        }

        function updateSubmitButton() {
            const submitContainer = document.getElementById('submit-container');

            if (currentQuestionIndex === questions.length - 1) {
                const allAnswered = questions.every(q => answers[q.key] !== undefined && answers[q.key] !== '');
                submitContainer.style.display = allAnswered ? 'block' : 'none';
            } else {
                submitContainer.style.display = 'none';
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            const question = questions[currentQuestionIndex];
            const hasAnswer = answers[question.key] !== undefined && answers[question.key] !== '';

            if (hasAnswer && currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function submitAnswers() {
            showSummary();
        }

        function showSummary() {
            isInSummaryMode = true;
            document.getElementById('screening-view').style.display = 'none';
            document.getElementById('summary-view').style.display = 'block';

            const summaryContainer = document.getElementById('summary-questions');
            summaryContainer.innerHTML = '';

            questions.forEach((question, index) => {
                let answer = answers[question.key];

                if (question.type === 'yesno' || question.type === 'choice') {
                    const enOptions = translations.en.questions[index].options || [];
                    const filOptions = translations.fil.questions[index].options || [];
                    if (currentLanguage === 'fil') {
                        const idx = enOptions.indexOf(answer);
                        if (idx !== -1) answer = filOptions[idx];
                        if (answer === "Yes") answer = "Oo";
                        if (answer === "No") answer = "Hindi";
                    } else {
                        const idx = filOptions.indexOf(answer);
                        if (idx !== -1) answer = enOptions[idx];
                        if (answer === "Oo") answer = "Yes";
                        if (answer === "Hindi") answer = "No";
                    }
                }

                const summaryItem = document.createElement('div');
                summaryItem.className = 'summary-item';

                let answerInput = '';
                if (question.type === 'number
