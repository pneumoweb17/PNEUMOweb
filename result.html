<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNEUMOweb - Screening Results</title>
    <link rel="stylesheet" href="result.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <nav class="navigation">
                <a href="index.html" class="nav-link">Home</a>
                <a href="pages.html?page=background" class="nav-link">Background</a>
                <a href="pages.html?page=faq" class="nav-link">FAQ</a>
                <a href="pages.html?page=feedback" class="nav-link">FEEDBACK</a>
            </nav>
            <div class="language-toggle">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="fil">Filipino</option>
                </select>
            </div>
        </header>

        <!-- Title Section -->
        <section class="title-section">
            <div class="logo-container">
                <div class="logo-placeholder">
                    <img src="logo.png" alt="PNEUMOweb Logo" class="logo-img">
                </div>
            </div>
            <div class="title-content">
                <h1 class="main-title">PNEUMOweb</h1>
                <p class="subtitle">Web-based pneumonia screening system</p>
            </div>
        </section>

        <!-- Body Section -->
        <section class="body-section">
            <div class="result-container">
                <!-- Left Half - Results Summary -->
                <div class="left-half">
                    <div class="risk-header">
                        <div class="print-risk-header">
                            <span id="print-risk-level"></span>
                        </div>
                        <div class="gauge">
                            <div class="gauge-needle" id="gaugeNeedle"></div>
                            <span class="gauge-label gauge-label-low">LOW</span>
                            <span class="gauge-label gauge-label-mid">MID</span>
                            <span class="gauge-label gauge-label-high">HIGH</span>
                        </div>
                        <div class="risk-bottom">
                            <h2>Risk Level</h2>
                            <div class="advice-box">
                                <p id="advice-text">Your advice here</p>
                            </div>
                        </div>
                    </div>

                    <div class="steps-box">
                            <p id="steps-text"></p>
                    </div>

                    <div class="questions-list">
                        <!-- Question items go here (same structure as before) -->
                        <!-- Each has id="answer-..." for answer population -->
                        <div class="question-item"><span class="question-number">1.</span><span class="question-text">How old are you?</span><span class="answer-text" id="answer-age"></span></div>
                        <div class="question-item"><span class="question-number">2.</span><span class="question-text">What is your sex/gender?</span><span class="answer-text" id="answer-gender"></span></div>
                        <div class="question-item"><span class="question-number">3.</span><span class="question-text">How many days have you been feeling unwell?</span><span class="answer-text" id="answer-unwell-days"></span></div>
                        <div class="question-item"><span class="question-number">4.</span><span class="question-text">Do you have a cough?</span><span class="answer-text" id="answer-cough"></span></div>
                        <div class="question-item"><span class="question-number">5.</span><span class="question-text">How long have you had this cough?</span><span class="answer-text" id="answer-cough-duration"></span></div>
                        <div class="question-item"><span class="question-number">6.</span><span class="question-text">Are you coughing up phlegm or thick mucus?</span><span class="answer-text" id="answer-phlegm"></span></div>
                        <div class="question-item"><span class="question-number">7.</span><span class="question-text">Do you have a fever?</span><span class="answer-text" id="answer-fever"></span></div>
                        <div class="question-item"><span class="question-number">8.</span><span class="question-text">Have you experienced chills or sweating?</span><span class="answer-text" id="answer-chills"></span></div>
                        <div class="question-item"><span class="question-number">9.</span><span class="question-text">Are you having difficulty breathing or do you feel short of breath?</span><span class="answer-text" id="answer-breathing-difficulty"></span></div>
                        <div class="question-item"><span class="question-number">10.</span><span class="question-text">Do you have chest pain when breathing deeply or coughing?</span><span class="answer-text" id="answer-chest-pain"></span></div>
                        <div class="question-item"><span class="question-number">11.</span><span class="question-text">Is your breathing faster than usual?</span><span class="answer-text" id="answer-fast-breathing"></span></div>
                        <div class="question-item"><span class="question-number">12.</span><span class="question-text">Do you feel weak or extremely tired?</span><span class="answer-text" id="answer-weakness"></span></div>
                        <div class="question-item"><span class="question-number">13.</span><span class="question-text">Have you lost your appetite in the past few days?</span><span class="answer-text" id="answer-appetite-loss"></span></div>
                        <div class="question-item"><span class="question-number">14.</span><span class="question-text">Have you experienced nausea or dizziness?</span><span class="answer-text" id="answer-nausea"></span></div>
                        <div class="question-item" id="child-feeding-item"><span class="question-number">15.</span><span class="question-text">Is the child feeding poorly or refusing food/milk?</span><span class="answer-text" id="answer-child-feeding"></span></div>
                        <div class="question-item" id="child-breathing-item"><span class="question-number">16.</span><span class="question-text">Is the child breathing rapidly or does the chest pull inward when breathing?</span><span class="answer-text" id="answer-child-breathing"></span></div>
                        <div class="question-item"><span class="question-number">17.</span><span class="question-text">Have you recently been sick with flu, colds, or any respiratory illness?</span><span class="answer-text" id="answer-recent-illness"></span></div>
                        <div class="question-item"><span class="question-number">18.</span><span class="question-text">Do you smoke or live with someone who smokes?</span><span class="answer-text" id="answer-smoking"></span></div>
                        <div class="question-item"><span class="question-number">19.</span><span class="question-text">Have you been vaccinated against pneumonia (such as PCV or flu vaccine)?</span><span class="answer-text" id="answer-vaccination"></span></div>
                        <div class="question-item"><span class="question-number">20.</span><span class="question-text">Do you have any chronic illnesses (asthma, heart disease, diabetes, weak immune system, or malnutrition)?</span><span class="answer-text" id="answer-chronic-illness"></span></div>
                        <div class="question-item"><span class="question-number">21.</span><span class="question-text">Do you have fast breathing for your age?</span><span class="answer-text" id="answer-fast-breathing-age"></span></div>
                    </div>

                </div>
                <div class="action-buttons-vertical">
                    <button id="print-button" class="icon-btn" onclick="printLeftHalf()"><span class="btn-icon"><i class="fas fa-print"></i></span> Print</button>
                    <button class="file-btn icon-btn" onclick="document.getElementById('file-input').click();"><span class="btn-icon"><i class="fas fa-file-upload"></i></span> Attach file with the result (Optional)</button>
                    <input type="file" id="file-input" accept="*/*" style="display: none;" onchange="handleFileAttachment(event)">
                    <div class="attached-file" id="attached-file" style="display: none;"><span id="file-name"></span><button onclick="removeFile()" class="remove-file-btn">Ã—</button></div>
                    <button class="save-btn icon-btn" onclick="saveResultLocally()"><span class="btn-icon"><i class="fas fa-save"></i></span> Save Result to local storage</button>
                    <button class="exit-btn icon-btn" onclick="exitResult()"><span class="btn-icon"><i class="fas fa-sign-out-alt"></i></span> Exit</button>
                </div>

            </div>
        </section>

        <!-- Footer Section -->
        <footer class="footer">
            <div class="disclaimer-box"><strong>Disclaimer:</strong> This screening tool is for informational purposes only and does not replace professional medical advice. Any information gathered are kept confidential.</div>
        </footer>
    </div>

    <div id="exit-modal" class="modal" style="display: none;"><div class="modal-content"><p id="exit-message">Do you want to leave without saving your result?</p><div class="modal-buttons"><button onclick="confirmExit()" class="modal-btn confirm">Yes</button><button onclick="cancelExit()" class="modal-btn cancel">No</button></div></div></div>

    <script>
        let screeningAnswers = {};

        function getAge() {
            const age = parseInt(screeningAnswers.age, 10);
            return isNaN(age) ? 0 : age;
        }

        function displayAnswers() {
            const lang = document.getElementById("languageSelect").value;
            const answerMapping = {
                'age': 'answer-age','gender': 'answer-gender','unwell_days': 'answer-unwell-days','cough': 'answer-cough','cough_duration': 'answer-cough-duration','phlegm': 'answer-phlegm','fever': 'answer-fever','chills': 'answer-chills','breathing_difficulty': 'answer-breathing-difficulty','chest_pain': 'answer-chest-pain','fast_breathing': 'answer-fast-breathing','weakness': 'answer-weakness','appetite_loss': 'answer-appetite-loss','nausea': 'answer-nausea','child_feeding': 'answer-child-feeding','child_breathing': 'answer-child-breathing','recent_illness': 'answer-recent-illness','smoking': 'answer-smoking','vaccination': 'answer-vaccination','chronic-illness': 'answer-chronic-illness','fast-breathing-age': 'answer-fast-breathing-age'
            };

            const keysOrder = Object.keys(answerMapping);
            const age = getAge();

            keysOrder.forEach((key, i) => {
                const elementId = answerMapping[key];
                const element = document.getElementById(elementId);
                if (!element) return;

                if (screeningAnswers[key] === "Skipped") {
                    element.textContent = lang === "fil" ? "Laktaw" : "Skipped";
                    element.style.color = "gray";
                } else if (screeningAnswers[key]) {
                    element.textContent = screeningAnswers[key];
                    element.style.color = "";
                } else {
                    element.textContent = "";
                    element.style.color = "";
                }
            });

            if (age >= 18) {
                document.getElementById('child-feeding-item').style.display = 'none';
                document.getElementById('child-breathing-item').style.display = 'none';
            } else {
                document.getElementById('child-feeding-item').style.display = '';
                document.getElementById('child-breathing-item').style.display = '';
            }
        }

        function saveResultLocally() {
            const resultData = {answers: screeningAnswers};
            const resultDocument = Object.keys(screeningAnswers).map(key => `${key}: ${screeningAnswers[key] === "Skipped" ? "Skipped" : screeningAnswers[key]}`).join('\n');
            const blob = new Blob([resultDocument], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pneumonia_screening_result.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            localStorage.setItem('latestScreeningResult', JSON.stringify(resultData));
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedAnswers = localStorage.getItem('screeningAnswers');
            if (savedAnswers) {
                screeningAnswers = JSON.parse(savedAnswers);
                displayAnswers();
            } else {
                alert('No screening data found. Please complete the screening first.');
                window.location.href = 'screening.html';
            }
        });
    </script>
</body>
</html>
